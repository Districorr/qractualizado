<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0077b6"/> <!-- Color para PWA -->
  <link rel="apple-touch-icon" href="icons/icon-192x192.png"> <!-- Icono para iOS -->

  <title>Esc치ner de GS1 y Barras</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="light"> <!-- Aseg칰rate de que 'light' o 'dark' se establezca inicialmente o por JS -->
  <!-- Bot칩n para cambiar modo oscuro/claro -->
  <div class="dark-mode-toggle" role="button" aria-label="Cambiar modo oscuro/claro" title="Cambiar modo oscuro/claro">游깹</div>

  <h2 style="text-align:center">Esc치ner de GS1 y Barras</h2>
  <div class="tabs">
    <div class="tab active" data-tab-target="scan" role="tab" aria-selected="true">游닝 Escanear</div>
    <div class="tab" data-tab-target="records" role="tab" aria-selected="false">游늬 Registros</div>
  </div>

  <!-- Secci칩n Escaner -->
  <div id="scan" class="section active" role="tabpanel">

    <!-- Contenedor General para Controles de Escaneo -->
    <div id="scanner-controls" style="text-align: center;">

        <!-- Bot칩n Principal para Iniciar el Escaneo (visible inicialmente) -->
        <button id="start-scan-button" class="action-buttons" style="margin: 1em auto; padding: 10px 20px; font-size: 1.1em;">Iniciar Escaneo</button>

        <!-- Contenedor para Controles Visibles SOLO Cuando el Esc치ner est치 Activo -->
        <div id="scanner-active-controls" style="display: none;">

            <!-- Selector de C치mara (sin 'onchange' aqu칤) -->
            <select id="camera-selector" aria-label="Seleccionar c치mara a usar" style="margin-bottom: 10px;">
              <option value="">Seleccionar c치mara...</option>
            </select>

            <!-- Bot칩n para Detener el Escaneo -->
            <button id="stop-scan-button" class="action-buttons" style="margin-left: 10px;">Detener</button>

            <!-- Vista Previa de la C치mara -->
            <div id="scanner-preview"></div>

            <!-- Mensajes de Estado -->
            <p id="camera-status" class="camera-error" aria-live="polite"></p>
            <p id="status" aria-live="polite">Esperando inicio...</p>
            <p><strong>Proveedor detectado:</strong> <span id="proveedor-auto">---</span></p>
            <p><strong>Resultado Crudo:</strong></p>

            <!-- 츼rea de Resultado -->
            <textarea id="resultado" rows="4" aria-label="Resultado del escaneo"></textarea>

            <!-- Botones de Acci칩n (Copiar/Limpiar) -->
            <div class="action-buttons">
                <button id="copy-button" title="Copiar resultado" aria-label="Copiar resultado del escaneo al portapapeles">Copiar</button>
                <button id="clear-button" title="Limpiar resultado" aria-label="Limpiar resultados del escaneo">Limpiar</button>
            </div>

            <!-- Secci칩n para Datos GS1 Interpretados -->
            <div id="gs1-parsed-data" class="gs1-data">
                <h4>Datos GS1 Interpretados:</h4>
                <div id="gs1-fields">
                    <!-- Los campos se insertar치n aqu칤 din치micamente por JS -->
                </div>
            </div>

            <!-- Contenedor para la Captura de Pantalla -->
            <div id="captura-container"></div>

            <!-- Opciones Adicionales -->
            <div class="options">
                <label>
                    <input type="checkbox" id="sound-toggle" checked aria-label="Activar o desactivar sonido al escanear">
                    Reproducir sonido al escanear
                </label>
                <br>
                <label>
                    <input type="checkbox" id="auto-clear-toggle" aria-label="Activar o desactivar limpieza autom치tica del resultado">
                    Limpiar resultado autom치ticamente (tras 3 seg)
                </label>
            </div>
        </div> <!-- Fin de scanner-active-controls -->
    </div> <!-- Fin de scanner-controls -->
  </div> <!-- Fin de secci칩n scan -->

  <!-- Secci칩n Registros anteriores (Placeholder) -->
  <div id="records" class="section" role="tabpanel">
    <h3>Buscar registros anteriores</h3>
    <p><i>(Funcionalidad de registros no implementada todav칤a)</i></p>
    <input type="text" placeholder="Buscar por lote, serie o proveedor..." disabled aria-label="Buscar en registros anteriores">
    <div id="tabla-registros">(aqu칤 aparecer치 la tabla)</div>
  </div>

  <!-- Cargar Librer칤as ANTES -->
  <script src="libs/html5-qrcode.min.js"></script>
  <!-- html2canvas es opcional, si no lo usas puedes quitarlo -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Cargar script custom DESPU칄S de librer칤as -->
  <script src="scanner.js"></script>
</body>
</html>
